"use strict";function _slicedToArray(a,b){return _arrayWithHoles(a)||_iterableToArrayLimit(a,b)||_unsupportedIterableToArray(a,b)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(b,c){var d=null==b?null:"undefined"!=typeof Symbol&&b[Symbol.iterator]||b["@@iterator"];if(null!=d){var g,h,j,k,l=[],a=!0,m=!1;try{if(j=(d=d.call(b)).next,0===c){if(Object(d)!==d)return;a=!1}else for(;!(a=(g=j.call(d)).done)&&(l.push(g.value),l.length!==c);a=!0);}catch(a){m=!0,h=a}finally{try{if(!a&&null!=d["return"]&&(k=d["return"](),Object(k)!==k))return}finally{if(m)throw h}}return l}}function _arrayWithHoles(a){if(Array.isArray(a))return a}function _createForOfIteratorHelper(b,c){var d="undefined"!=typeof Symbol&&b[Symbol.iterator]||b["@@iterator"];if(!d){if(Array.isArray(b)||(d=_unsupportedIterableToArray(b))||c&&b&&"number"==typeof b.length){d&&(b=d);var e=0,f=function(){};return{s:f,n:function(){return e>=b.length?{done:!0}:{done:!1,value:b[e++]}},e:function(a){throw a},f:f}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var g,h=!0,i=!1;return{s:function(){d=d.call(b)},n:function(){var a=d.next();return h=a.done,a},e:function(a){i=!0,g=a},f:function(){try{h||null==d["return"]||d["return"]()}finally{if(i)throw g}}}}function _unsupportedIterableToArray(b,c){if(b){if("string"==typeof b)return _arrayLikeToArray(b,c);var a={}.toString.call(b).slice(8,-1);return"Object"===a&&b.constructor&&(a=b.constructor.name),"Map"===a||"Set"===a?Array.from(b):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(b,c):void 0}}function _arrayLikeToArray(b,c){(null==c||c>b.length)&&(c=b.length);for(var d=0,f=Array(c);d<c;d++)f[d]=b[d];return f}var data=null,graph=null,hide_widgets=!!(800>window.screen.width),lang_input=d3.select("#set-language"),label_nodes=new Map,node_info=d3.select("#node-info"),node_info_content=d3.select("#node-info .content"),node_labels=new Map,zoomScale=d3.scaleLog().domain([1,400]).range([4,.5]),hash_map=getHashMap();("off"==hash_map.get("widgets")||hide_widgets)&&(hide_widgets=!0,d3.selectAll(".widget").style("display","none")),d3.json("/influence-graph.json").then(function(a){data=a;var b,c=d3.select("#languages"),d=_createForOfIteratorHelper(data.nodes);try{for(d.s();!(b=d.n()).done;){var e=b.value,f=acronymize(e.label);c.append("option").attr("value",f).text(f),e.label=f,node_labels.set(e.id,f),label_nodes.set(f,e.id)}}catch(a){d.e(a)}finally{d.f()}initGraph(data.nodes,data.links);var g=hash_map.get("language");if(g){var h=label_nodes.get(g);h&&setLanguage(h)}lang_input.on("input",function(a){var b=a.target.value;if(!b)return void reset();var c=label_nodes.get(b);c&&setLanguage(c,!1)}),d3.selectAll(".delete").on("click",function(a){return a.target.parentNode.style.display="none"})});function acronymize(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:5,c=a.split(/\s+/);return c.length>=b?c.map(function(a){return a[0]}).join(""):a}function appendLanguages(a,b,c){b.length&&(a.append("h3").text(c),a.append("div").attr("class","links").selectAll("span").data(b.sort()).enter().append("span").append("a").text(function(a){return a}).on("click",function(a,b){return setLanguage(label_nodes.get(b))}))}function getHashMap(){if(!document.location.hash||10>document.location.hash.length)return new Map;var a,b=new Map,c=_createForOfIteratorHelper(document.location.hash.substr(1).split("&"));try{for(c.s();!(a=c.n()).done;){var d=a.value,e=d.split("="),f=_slicedToArray(e,2),g=f[0],h=f[1];b.set(g,acronymize(decodeURIComponent(h)))}}catch(a){c.e(a)}finally{c.f()}return b}function initGraph(a,b){graph&&graph.clear(),graph=new DiGraph(a,b,"outdegree"),graph.draw("#network"),initUI(graph)}function initUI(a){d3.selectAll(".edge-count").text(a.edges.length),d3.selectAll(".node-count").text(a.nodes.length);var b=d3.selectAll(".edge-plural");1==a.edges.length?b.style("display","none"):b.style("display","contents");var c=a.width/15,d=a.height/15,e=1.5;d3.selectAll("#network-nav button").on("click",function(b){var f=b.target.classList;f.contains("in")?a.zoom.scaleBy(a.g,e):f.contains("out")?a.zoom.scaleBy(a.g,1/e):f.contains("reset")?(a.zoom.scaleTo(a.g,zoomScale(a.nodes.length)),a.zoom.translateTo(a.g,a.width/2,a.height/2),reset()):f.contains("left")?a.zoom.translateBy(a.g,c,0):f.contains("right")?a.zoom.translateBy(a.g,-c,0):f.contains("up")?a.zoom.translateBy(a.g,0,d):f.contains("down")&&a.zoom.translateBy(a.g,0,-d)}),a.zoom.scaleTo(a.g,zoomScale(a.nodes.length)),a.svg.selectAll("g.nodes circle").on("click",function(a){var b=d3.select(a.target).attr("node-id");b&&setLanguage(b)})}function reset(){initGraph(data.nodes,data.links),document.location.hash="",node_info.style("display","none"),lang_input.node().value=""}function setLanguage(a){var b,c=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],d=[],e=[],f=new Set([a]),g=_createForOfIteratorHelper(data.links);try{for(g.s();!(b=g.n()).done;){var h=b.value;h.source==a?(f.add(h.target),e.push(node_labels.get(h.target))):h.target==a&&(f.add(h.source),d.push(node_labels.get(h.source)))}}catch(a){g.e(a)}finally{g.f()}var i=data.nodes.filter(function(a){return f.has(a.id)}),j=data.links.filter(function(a){return f.has(a.source)&&f.has(a.target)});initGraph(i,j);var k=graph.node_index.get(a).attr;hash_map.set("language",encodeURIComponent(node_labels.get(a)));var l=Array.from(hash_map.entries()).map(function(a){return a.join("=")});if(l.length&&(document.location.hash=l.join("&")),!hide_widgets){c&&(lang_input.node().value=k.label),node_info.style("display","block"),node_info_content.selectAll("*").remove(),node_info_content.append("h2").text(k.label),appendLanguages(node_info_content,d,"Influenced by"),appendLanguages(node_info_content,e,"Influenced"),node_info_content.append("h3").text("More info");var m=node_info_content.append("ul");m.append("li").append("a").attr("href","/language/".concat(k.slug,"/")).text("".concat(k.label)),m.append("li").append("a").attr("href","https://www.wikidata.org/wiki/".concat(a)).text("wikidata.org/wiki/".concat(a))}}