"use strict";function _slicedToArray(a,b){return _arrayWithHoles(a)||_iterableToArrayLimit(a,b)||_unsupportedIterableToArray(a,b)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(a,b){var c=null==a?null:"undefined"!=typeof Symbol&&a[Symbol.iterator]||a["@@iterator"];if(null!=c){var d,e,f=[],g=!0,h=!1;try{for(c=c.call(a);!(g=(d=c.next()).done)&&(f.push(d.value),!(b&&f.length===b));g=!0);}catch(a){h=!0,e=a}finally{try{g||null==c["return"]||c["return"]()}finally{if(h)throw e}}return f}}function _arrayWithHoles(a){if(Array.isArray(a))return a}function _createForOfIteratorHelper(a,b){var c="undefined"!=typeof Symbol&&a[Symbol.iterator]||a["@@iterator"];if(!c){if(Array.isArray(a)||(c=_unsupportedIterableToArray(a))||b&&a&&"number"==typeof a.length){c&&(a=c);var d=0,e=function(){};return{s:e,n:function n(){return d>=a.length?{done:!0}:{done:!1,value:a[d++]}},e:function e(a){throw a},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f,g=!0,h=!1;return{s:function s(){c=c.call(a)},n:function n(){var a=c.next();return g=a.done,a},e:function e(a){h=!0,f=a},f:function f(){try{g||null==c["return"]||c["return"]()}finally{if(h)throw f}}}}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}var data=null,graph=null,hide_widgets=!!(800>window.screen.width),lang_input=d3.select("#set-language"),label_nodes=new Map,node_info=d3.select("#node-info"),node_info_content=d3.select("#node-info .content"),node_labels=new Map,zoomScale=d3.scaleLog().domain([1,400]).range([4,.5]),hash_map=getHashMap();("off"==hash_map.get("widgets")||hide_widgets)&&(hide_widgets=!0,d3.selectAll(".widget").style("display","none")),d3.json("/influence-graph.json").then(function(a){data=a;var b,c=d3.select("#languages"),d=_createForOfIteratorHelper(data.nodes);try{for(d.s();!(b=d.n()).done;){var e=b.value,f=acronymize(e.label);c.append("option").attr("value",f).text(f),e.label=f,node_labels.set(e.id,f),label_nodes.set(f,e.id)}}catch(a){d.e(a)}finally{d.f()}initGraph(data.nodes,data.links);var g=hash_map.get("language");if(g){var h=label_nodes.get(g);h&&setLanguage(h)}lang_input.on("input",function(){var a=d3.event.target.value;if(!a)return void reset();var b=label_nodes.get(a);b&&setLanguage(b,!1)}),d3.selectAll(".delete").on("click",function(){return d3.event.target.parentNode.style.display="none"})});function acronymize(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:5,c=a.split(/\s+/);return c.length>=b?c.map(function(a){return a[0]}).join(""):a}function appendLanguages(a,b,c){b.length&&(a.append("h3").text(c),a.append("div").attr("class","links").selectAll("span").data(b.sort()).enter().append("span").append("a").text(function(a){return a}).on("click",function(a){return setLanguage(label_nodes.get(a))}))}function getHashMap(){if(!document.location.hash||10>document.location.hash.length)return new Map;var a,b=new Map,c=_createForOfIteratorHelper(document.location.hash.substr(1).split("&"));try{for(c.s();!(a=c.n()).done;){var d=a.value,e=d.split("="),f=_slicedToArray(e,2),g=f[0],h=f[1];b.set(g,acronymize(decodeURIComponent(h)))}}catch(a){c.e(a)}finally{c.f()}return b}function initGraph(a,b){graph&&graph.clear(),graph=new DiGraph(a,b,"outdegree"),graph.draw("#network"),initUI(graph)}function initUI(a){d3.selectAll(".edge-count").text(a.edges.length),d3.selectAll(".node-count").text(a.nodes.length);var b=d3.selectAll(".edge-plural");1==a.edges.length?b.style("display","none"):b.style("display","contents");var c=a.width/15,d=a.height/15,e=1.5;d3.selectAll("#network-nav button").on("click",function(){var b=d3.event.target.classList;b.contains("in")?a.zoom.scaleBy(a.g,e):b.contains("out")?a.zoom.scaleBy(a.g,1/e):b.contains("reset")?(a.zoom.scaleTo(a.g,zoomScale(a.nodes.length)),a.zoom.translateTo(a.g,a.width/2,a.height/2),reset()):b.contains("left")?a.zoom.translateBy(a.g,c,0):b.contains("right")?a.zoom.translateBy(a.g,-c,0):b.contains("up")?a.zoom.translateBy(a.g,0,d):b.contains("down")&&a.zoom.translateBy(a.g,0,-d)}),a.zoom.scaleTo(a.g,zoomScale(a.nodes.length)),a.svg.selectAll("g.nodes circle").on("click",function(){var a=d3.select(d3.event.target).attr("node-id");a&&setLanguage(a)})}function reset(){initGraph(data.nodes,data.links),document.location.hash="",node_info.style("display","none"),lang_input.node().value=""}function setLanguage(a){var b,c=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],d=[],e=[],f=new Set([a]),g=_createForOfIteratorHelper(data.links);try{for(g.s();!(b=g.n()).done;){var m=b.value;m.source==a?(f.add(m.target),e.push(node_labels.get(m.target))):m.target==a&&(f.add(m.source),d.push(node_labels.get(m.source)))}}catch(a){g.e(a)}finally{g.f()}var h=data.nodes.filter(function(a){return f.has(a.id)}),i=data.links.filter(function(a){return f.has(a.source)&&f.has(a.target)});initGraph(h,i);var j=graph.node_index.get(a).attr;hash_map.set("language",encodeURIComponent(node_labels.get(a)));var k=Array.from(hash_map.entries()).map(function(a){return a.join("=")});if(k.length&&(document.location.hash=k.join("&")),!hide_widgets){c&&(lang_input.node().value=j.label),node_info.style("display","block"),node_info_content.selectAll("*").remove(),node_info_content.append("h2").text(j.label),appendLanguages(node_info_content,d,"Influenced by"),appendLanguages(node_info_content,e,"Influenced"),node_info_content.append("h3").text("More info");var l=node_info_content.append("ul");l.append("li").append("a").attr("href","/language/".concat(j.slug,"/")).text("".concat(j.label)),l.append("li").append("a").attr("href","https://www.wikidata.org/wiki/".concat(a)).text("wikidata.org/wiki/".concat(a))}}